# Go 后台服务目录模板（按服务类型）

说明：目录均为建议模板，需结合《软件开发原则》的边界/契约/编码红线使用。
命名使用小写、无空格，`internal` 不跨服务共享；对外只暴露 `api/` 契约；可复用库放 `pkg/` 并版本化。

## 共通目录要点
```
.
├─ cmd/                     # 各可执行入口，每个二进制一个子目录
├─ internal/                # 服务私有代码，不得被其他服务依赖
│  ├─ domain/               # 领域模型（可选）
│  ├─ service/              # 业务用例/应用层
│  ├─ handler/              # 入站适配层（http/grpc/event/schedule）
│  ├─ repo/                 # 存储适配器（DB/缓存/搜索）
│  └─ platform/             # 基础设施封装（db/cache/mq/logger/config/clients）
├─ pkg/                     # 可复用库，需稳定 API、版本化
├─ api/                     # 对外/跨服务契约（OpenAPI/proto/事件 schema/DTO）
├─ configs/                 # 配置模板
├─ migrations/              # 数据迁移（含回滚脚本）
├─ scripts/                 # 辅助脚本（生成代码/检查/工具）
└─ deploy/                  # CI/CD、容器/Helm 等部署配置
```

## REST API 服务
```
.
├─ cmd/
│  └─ api/main.go
├─ api/
│  └─ http/openapi.yaml        # OpenAPI 契约
├─ internal/
│  ├─ handler/http/            # 路由、请求校验、DTO
│  ├─ service/                 # 业务用例
│  ├─ repo/                    # DB/缓存适配器
│  ├─ domain/                  # 领域模型（可选）
│  └─ platform/                # db/cache/logger/config/clients
├─ configs/
├─ migrations/
├─ scripts/
└─ deploy/
```

## gRPC 微服务
```
.
├─ cmd/
│  └─ grpc/main.go
├─ api/
│  └─ proto/<svc>.proto        # gRPC 契约，生成 pb 代码
├─ internal/
│  ├─ handler/grpc/            # gRPC Server，实现 pb 接口
│  │  └─ pb/                   # 生成的 pb（建议隔离在 handler 子目录）
│  ├─ service/
│  ├─ repo/
│  ├─ domain/
│  └─ platform/
├─ configs/
├─ migrations/
├─ scripts/
└─ deploy/
```

## 网关服务（API 聚合/路由/策略）
```
.
├─ cmd/
│  └─ gateway/main.go
├─ api/
│  └─ http/openapi.yaml        # 对外契约
├─ internal/
│  ├─ handler/http/            # 路由、聚合、请求校验
│  ├─ upstream/                # 下游客户端封装（http/grpc），含重试/超时/熔断
│  ├─ policy/                  # 鉴权、限流、熔断、流控策略
│  ├─ cache/                   # 缓存策略（如接口缓存）
│  └─ platform/                # 基础设施
├─ configs/
├─ scripts/
└─ deploy/
```

## 事件驱动服务（消费/生产）
```
.
├─ cmd/
│  └─ worker/main.go
├─ api/
│  └─ events/<schema>.yaml     # 事件 schema/契约
├─ internal/
│  ├─ handler/event/           # 订阅/发布包装，解码/编码
│  ├─ service/                 # 事件处理业务
│  ├─ repo/                    # DB/缓存/搜索适配器
│  ├─ platform/mq/             # 消息中间件客户端封装
│  └─ platform/                # 其他基础设施
├─ configs/
├─ migrations/                 # 如有持久化变更
├─ scripts/
└─ deploy/
```

## 系统对接/集成服务（含定时任务）
```
.
├─ cmd/
│  └─ integration/main.go
├─ api/
│  ├─ http/openapi.yaml        # 如需暴露回调/入站接口
│  └─ proto/<svc>.proto        # 如需 gRPC 入站
├─ internal/
│  ├─ handler/schedule/        # 定时/触发器（cron/队列驱动）
│  ├─ handler/http/            # 回调/入站接口（可选）
│  ├─ partner/                 # 第三方客户端封装（签名/重试/节流）
│  ├─ service/                 # 编排逻辑
│  ├─ repo/                    # 存储
│  └─ platform/                # 基础设施
├─ configs/
├─ migrations/
├─ scripts/
└─ deploy/
```

## 目录/命名注意事项
- 使用小写/下划线，不用大写/空格。
- 文件名体现职责：`user_handler.go`、`user_service.go`、`user_repo.go`。
- `internal` 内的类型/函数尽量最小可见性；跨包暴露接口而非结构体字段。
- 生成代码（proto/pb/openapi client）放在靠近 handler 的子目录，避免污染手写代码。
- 可复用但不稳定的代码，留在 `internal/`；稳定复用库才放 `pkg/` 并版本化。
