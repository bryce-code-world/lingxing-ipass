<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{.title}} - Admin</title>
    <link rel="stylesheet" href="/admin/ui/static/admin.css">
  </head>
  <body>
    <header class="topbar">
      <div class="topbar-inner">
        <div class="brand">iPass Admin</div>
        <nav class="nav">
          <a href="/admin/ui/">总览</a>
          <a href="/admin/ui/orders">订单</a>
          <a href="/admin/ui/manual_tasks">人工</a>
          <a href="/admin/ui/watermarks">水位</a>
          <a href="/admin/ui/jobs">任务</a>
        </nav>
        <form class="logout" method="post" action="/admin/ui/logout">
          <button class="btn btn-ghost" type="submit">退出</button>
        </form>
      </div>
    </header>
    <main class="container">
      <h1 class="h1">水位管理</h1>

      <div class="grid">
        <div class="card">
          <div class="card-title">现有水位</div>
          <table class="table">
            <thead>
              <tr><th style="width:220px;">job</th><th>watermark</th></tr>
            </thead>
            <tbody>
              {{range .items}}
              <tr>
                <td><code>{{.JobName}}</code></td>
                <td><code>{{safeJSON .Watermark}}</code></td>
              </tr>
              {{else}}
              <tr><td colspan="2" class="muted">暂无数据</td></tr>
              {{end}}
            </tbody>
          </table>
        </div>

        <div class="card">
          <div class="card-title">编辑水位</div>
          <div class="muted">提交前会做 JSON 校验；成功后立即写入数据库。</div>
          <form id="watermarkForm" style="margin-top:12px;">
            <label class="label" for="job">job</label>
            <input class="input" id="job" name="job" placeholder="例如 pull_dsco_orders" value="{{.selected}}">
            <label class="label" for="watermark" style="margin-top:10px;">watermark(JSON)</label>
            <textarea class="textarea" id="watermark" name="watermark" placeholder='{"mode":"updatedSince","since":"1970-01-01T00:00:00Z"}'>{{.watermark}}</textarea>
            <div style="margin-top:10px;">
              <button class="btn" type="submit">提交</button>
            </div>
          </form>
          <div class="muted" style="margin-top:10px;">注意：设置过大的水位可能导致跳过数据；建议先备份旧值。</div>
        </div>
      </div>
    </main>
    <script src="/admin/ui/static/admin.js"></script>
  </body>
</html>

